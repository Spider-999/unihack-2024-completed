{% extends "base.html" %}

{% block content %}

<div class="container mt-4">
    <div class="row">
        <!-- Left Profile Info Section -->
        <div class="col-12 col-md-6">
            <div class="form-container">
                <!-- Profile Info Container -->
                <div class="profile-info-container p-3 mb-4">
                    <div class="media">
                        <img class="rounded-circle account-img" src="{{ image_file }}" alt="Profile Image">
                        <div class="media-body ms-3">
                            <h3> {{ current_user.username }} </h3>
                            <p> {{ current_user.email }} </p>
                            <h3>Level: {{ current_user.level }}</h3>
                            <div class="progress">
                                <div id="experienceProgress" class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" 
                                aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width:0%;">current_user.experience</div>
                            </div>
                            <p> Data alaturarii: {{ current_user.date_joined.strftime('%d-%m-%Y') }}</p>
                            <p> Raspunsuri corecte: {{ current_user.correct_answers }} </p>
                            <p> Serie zilnica: {{ current_user.streak }} </p>
                            <p> Rol: {{ current_user.user_role }} </p>
                            <p> Badgeuri: </p>
                            <span>
                                {% for badge in current_user.badges %}
                                    <p> {{ badge.name }} 
                                    <img class="rounded-circle badge-img" 
                                    src="{{image_file}}"> </p>
                                    {{badge.image_file}}
                                {% endfor %}
                            </span>
                        </div>
                    </div>
                </div>

                <!-- Profile Form -->
                <form method="POST" enctype="multipart/form-data" action="">
                    {{ form.hidden_tag() }}

                    <div class="form-group mb-3">
                        <!-- Making "Schimba avatarul" blue and bold -->
                        {{ form.picture.label(class="form-label fw-bold text-primary") }}
                        {{ form.picture(class="form-control") }}
                    </div>

                    <div class="form-group">
                        {{ form.submit(class="btn btn-primary") }}
                    </div>
                </form>
            </div>
        </div>

        <!-- Right Blue Rectangle Container adjusted to screen width -->
        <div class="col-12 col-md-6 mt-4 mt-md-0 align-content-center">
            <div class="list-container d-flex flex-column justify-content-center align-items-center bg-primary text-white rounded p-4">
                <ul class="list-unstyled text-center">
                    <li>Element 1</li>
                    <li>Element 2</li>
                    <li>Element 3</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<script>
    let currentExperience = current_user.experience; // Current experience

    const maxExperience = 100; // Maximum experience for the level


    function updateProgress() 
    {
        fetch('/profile/get_experience')

            .then(response => response.json())

            .then(data => {

                const experience = data.experience;

                const maxExperience = 100;

                const percentage = (experience / maxExperience) * 100;


                // Update the progress bar

                const progressBar = document.getElementById('experienceProgress');

                progressBar.style.width = percentage + '%';

                progressBar.setAttribute('aria-valuenow', percentage);

                progressBar.innerText = Math.round(percentage) + '%';


                if (experience >= maxExperience) {

                    alert("Congratulations! You've reached the maximum experience level!");

                }

            });
    }

    document.addEventListener("DOMContentLoaded", function() {

        updateExperience(); // Automatically updates progress on page load

    });

</script>

{% endblock %}